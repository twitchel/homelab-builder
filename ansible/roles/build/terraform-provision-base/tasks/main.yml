- name: Provision Terraform config
  delegate_to: localhost
  block:
    - name: Create temporary directory for terraform plan
      run_once: true
      file:
        name: "{{ terraform.dir }}"
        state: directory

    - name: Create terraform main.tf file
      when: "inventory_hostname in groups['proxmox_servers']"
      run_once: true
      template:
        src: main.tf.j2
        dest: "{{ terraform.dir }}/main.tf"

    - name: Create terraform vars_common.tf file
      when: "inventory_hostname in groups['proxmox_servers']"
      run_once: true
      template:
        src: vars_common.tf.j2
        dest: "{{ terraform.dir }}/vars_common.tf"